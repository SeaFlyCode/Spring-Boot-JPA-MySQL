<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boutique de Th√©s</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5dc;
        }
        .navbar {
            background-color: #2d5a27 !important;
        }
        .btn-primary {
            background-color: #2d5a27;
            border-color: #2d5a27;
        }
        .btn-primary:hover {
            background-color: #1e3d1a;
            border-color: #1e3d1a;
        }
        .card {
            border-color: #2d5a27;
        }
        .card-header {
            background-color: #2d5a27;
            color: white;
        }
        .table thead {
            background-color: #2d5a27;
            color: white;
        }
        .sortable {
            color: white;
            text-decoration: none;
        }
        .sortable:hover {
            color: #ddd;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">üçµ Boutique de Th√©s</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h2 class="mb-0">Liste des Th√©s</h2>
                <a th:href="@{/nouveau}" class="btn btn-light">
                    <i class="bi bi-plus-circle"></i> Ajouter un th√©
                </a>
            </div>
            <div class="card-body">
                <!-- Recherche et filtre -->
                <form th:action="@{/}" method="get" class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-5">
                            <input type="text" name="recherche" class="form-control"
                                   placeholder="Rechercher par nom..." th:value="${recherche}">
                        </div>
                        <div class="col-md-4">
                            <select name="typeThe" class="form-select">
                                <option value="">-- Tous les types --</option>
                                <option th:each="type : ${typesThe}" th:value="${type}" th:text="${type}"
                                        th:selected="${type == typeTheFiltre}"></option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary me-2">
                                <i class="bi bi-search"></i> Rechercher
                            </button>
                            <a th:href="@{/}" class="btn btn-secondary">Reset</a>
                        </div>
                    </div>
                </form>

                <!-- Tableau -->
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>
                                    <a th:href="@{/(sortBy='nom', sortDir=${sortBy == 'nom' ? reverseSortDir : 'asc'}, recherche=${recherche}, typeThe=${typeTheFiltre})}"
                                       class="sortable">
                                        Nom
                                        <i th:if="${sortBy == 'nom'}" th:class="${sortDir == 'asc'} ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                                    </a>
                                </th>
                                <th>Type</th>
                                <th>Origine</th>
                                <th>
                                    <a th:href="@{/(sortBy='prix', sortDir=${sortBy == 'prix' ? reverseSortDir : 'asc'}, recherche=${recherche}, typeThe=${typeTheFiltre})}"
                                       class="sortable">
                                        Prix
                                        <i th:if="${sortBy == 'prix'}" th:class="${sortDir == 'asc'} ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                                    </a>
                                </th>
                                <th>
                                    <a th:href="@{/(sortBy='quantiteStock', sortDir=${sortBy == 'quantiteStock' ? reverseSortDir : 'asc'}, recherche=${recherche}, typeThe=${typeTheFiltre})}"
                                       class="sortable">
                                        Stock
                                        <i th:if="${sortBy == 'quantiteStock'}" th:class="${sortDir == 'asc'} ? 'bi bi-arrow-up' : 'bi bi-arrow-down'"></i>
                                    </a>
                                </th>
                                <th>Date r√©ception</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="produit : ${produits}">
                                <td th:text="${produit.id}"></td>
                                <td th:text="${produit.nom}"></td>
                                <td>
                                    <span class="badge" th:classappend="${produit.typeThe == 'Vert'} ? 'bg-success' :
                                        (${produit.typeThe == 'Noir'} ? 'bg-dark' :
                                        (${produit.typeThe == 'Oolong'} ? 'bg-warning text-dark' :
                                        (${produit.typeThe == 'Blanc'} ? 'bg-light text-dark' : 'bg-secondary')))"
                                       th:text="${produit.typeThe}"></span>
                                </td>
                                <td th:text="${produit.origine}"></td>
                                <td th:text="${#numbers.formatDecimal(produit.prix, 1, 2)} + ' ‚Ç¨'"></td>
                                <td th:text="${produit.quantiteStock}"></td>
                                <td th:text="${produit.dateReception != null} ? ${#temporals.format(produit.dateReception, 'dd/MM/yyyy')} : '-'"></td>
                                <td>
                                    <a th:href="@{/modifier/{id}(id=${produit.id})}" class="btn btn-warning btn-sm">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <button type="button" class="btn btn-danger btn-sm"
                                            th:data-id="${produit.id}"
                                            th:data-nom="${produit.nom}"
                                            onclick="confirmerSuppression(this)">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div th:if="${#lists.isEmpty(produits)}" class="alert alert-info">
                    Aucun produit trouv√©. <a th:href="@{/nouveau}">Ajouter un th√©</a>
                </div>

                <div th:unless="${#lists.isEmpty(produits)}" class="text-muted mt-2">
                    <small th:text="'Total: ' + ${#lists.size(produits)} + ' produit(s)'"></small>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal suppression -->
    <div class="modal fade" id="modalSupprimer" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">Confirmation</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Voulez-vous vraiment supprimer le produit "<span id="nomProduit"></span>" ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <a id="btnConfirmer" href="#" class="btn btn-danger">Supprimer</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function confirmerSuppression(btn) {
            var id = btn.getAttribute('data-id');
            var nom = btn.getAttribute('data-nom');
            document.getElementById('nomProduit').textContent = nom;
            document.getElementById('btnConfirmer').href = '/supprimer/' + id;
            var modal = new bootstrap.Modal(document.getElementById('modalSupprimer'));
            modal.show();
        }
    </script>
</body>
</html>
